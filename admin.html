<html>
<style>
#to{
    border-radius: 20px;
padding:10px;
}
#succ{
	display: none;
}
</style>
<head>
	<title>ADMIN</title>
</head>
<body>
	<div id="to">
	<img id="i1" src="1.jpg"></img>
	</div>
	<div>
	<h1>Upload Document</h1>
		<label>Upload File
			<input type="file" id="file">
		</label>
	<button type="btn btn-primary" id="uploadButton" onclick="uploadFile()">UPLOAD</button>
	<p id="succ">UPLOAD SUCCESSFUL</button>
	<div id="Docs">
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	
	<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
	<script>
  	// Initialize Firebase
  	var config = {
    	apiKey: "AIzaSyA59raQCpOBsJNshRgd7fTHtbDNnSo3YFw",
    	authDomain: "documentms-22178.firebaseapp.com",
    	databaseURL: "https://documentms-22178.firebaseio.com",
    	projectId: "documentms-22178",
    	storageBucket: "documentms-22178.appspot.com",
    	messagingSenderId: "444428646734"
  	};
  	firebase.initializeApp(config);
	
	var dbref = firebase.database().ref().child('Docs');
  	var datatodisplay="<ol>";
  	var idnum=0;
  	var delstr = 'deleteclass';
	dbref.on('value', function(snapshot){
    		snapshot.forEach(function(item){
        		var dict = item.val();
        		var url = dict['url'];
        		var name = dict['name'];
        		datatodisplay += "<li><ul>"
        		datatodisplay += "<li>"+"name : "+ name +"</li>";
        		datatodisplay += "<li>"+"url : "+ url +"</li>";
        		datatodisplay += "<li>"+ "<button class="+delstr+" id="+item.key+">DELETE</button>" +"</li>";
        		idnum++;
        		datatodisplay += "</ul></li>";
    		});
    		datatodisplay += "</ol>";
    		document.getElementById("Docs").innerHTML = datatodisplay;
    		$(".deleteclass").click(function(){
      			console.log(this.id+'');
      			datatodisplay = '<ol>';
      			dbref.child(this.id).remove();
    		});
  		//console.log('val: ' + snapshot.val());
  	});

	$(document).ready(function() {
		$("#uploadButton").hide();
	});
	$("#file").on("change",function(event) {
		selectedFile = event.target.files[0];
		$("#uploadButton").show();
	});
	function uploadFile(){
		var filename = selectedFile.name;
		console.log(filename);
		var storageRef = firebase.storage().ref();
		var docRef1 = storageRef.child('KEC/');
		var docRef = docRef1.child(filename);
		var upl = docRef.put(selectedFile);
		var link;
		upl.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
  			function(snapshot) {
    			var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
    			console.log('Upload is ' + progress + '% done');
    			switch (snapshot.state) {
      				case firebase.storage.TaskState.PAUSED: // or 'paused'
        				console.log('Upload is paused');
        			break;
      				case firebase.storage.TaskState.RUNNING: // or 'running'
        				console.log('Upload is running');
        			break;
    			}
  			}, function(error) {
  				switch (error.code) {
    					case 'storage/unauthorized':
      						break;

    					case 'storage/canceled':
      						break;

    					case 'storage/unknown':
      						break;
  				}
			}, function() {
  				upl.snapshot.ref.getDownloadURL().then(function(downloadURL) {
    					console.log('File available at', downloadURL);
					link=downloadURL;
					var dbref= firebase.database().ref('Docs');
					dbref.push({
						name: filename,
						url: link
					});
					
					document.getElementById('succ').style.display = 'block';
					var delayInMilliseconds = 3000; //1 second

					setTimeout(function() {
					document.getElementById('succ').style.display = 'none';
					}, delayInMilliseconds);
  				});
		});
}
</script>
</body>
</html>

